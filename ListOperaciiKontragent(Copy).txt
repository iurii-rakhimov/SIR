// ListOperaciiKontragent[Copy].txt
wait 1000, message="Ждите !"
HideListObjectForm("ListOperaciiKontragent", "Edit,Trash,Copy", ",")

strOperaciiKontragent = ^ArrayOperaciiKontragent[^indexCellOperaciiKontragent]
//print "strOperaciiKontragent =" + strOperaciiKontragent

GetComponentsOfStruct(^StructOperaciiKontragent, strOperaciiKontragent, ^DelimiterTab)
//print "ID =" + ID
IndexRecord = GetIndexArrayForSelectedComponentStruct(^ArrayRecords, ^StructRecord, 'ID', ID, ^DelimiterTab)
//print "IndexRecord =" + IndexRecord

// получили IndexRecord

strRecordOld = ^ArrayRecords[IndexRecord]
// читаем старую запись
GetComponentsOfStruct(^StructRecord, strRecordOld, ^DelimiterTab)
ID = GetDateTime()
strRecordNew = JoinedComponentsToStruct(^StructRecord, ^DelimiterTab)
//print "strRecordNew =" + strRecordNew

CountRecords = CountElementsOfArray(^ArrayRecords)
//print "CountRecords =" + CountRecords
^ArrayRecords[CountRecords] = strRecordNew

// запишем новую запись в файл
SaveRecord(Date, strRecordNew)

DoForm OperaciaKontragent
